---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import WorkCard from '../../components/WorkCard.astro';

const works = await getCollection('works');
const sortedWorks = works.sort((a, b) => a.data.order - b.data.order);
---

<Layout title="Works - Portfolio" description="作品一覧">
	<div class="container mx-auto px-4 sm:px-6 lg:px-8 py-12 max-w-7xl">
			<h1 class="text-4xl font-bold mb-12 text-gray-900 dark:text-white">Works</h1>

			<div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
				{sortedWorks.map((work) => (
					<WorkCard
						title={work.data.title}
						description={work.data.description}
						image={work.data.image}
						tags={work.data.tags}
						github={work.data.github}
						demo={work.data.demo}
						slug={work.slug}
						hasDetailPage={work.data.hasDetailPage}
					/>
				))}
			</div>

			{sortedWorks.length === 0 && (
				<div class="text-center py-20">
					<p class="text-gray-500 dark:text-gray-400 text-lg">
						作品はまだ追加されていません。
					</p>
				</div>
			)}

			<!-- 上へ戻るボタン -->
			<button
				id="scroll-to-top"
				class="fixed bottom-8 right-8 p-4 bg-purple-500 text-white rounded-full shadow-lg hover:bg-purple-600 transition-all duration-300 opacity-0 pointer-events-none z-50"
				aria-label="Scroll to top"
			>
				<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
				</svg>
			</button>
	</div>

	<script>
		// 上へ戻るボタン機能
		const scrollToTopBtn = document.getElementById('scroll-to-top');

		window.addEventListener('scroll', () => {
			if (window.scrollY > 300) {
				scrollToTopBtn?.classList.remove('opacity-0', 'pointer-events-none');
				scrollToTopBtn?.classList.add('opacity-100', 'pointer-events-auto');
			} else {
				scrollToTopBtn?.classList.add('opacity-0', 'pointer-events-none');
				scrollToTopBtn?.classList.remove('opacity-100', 'pointer-events-auto');
			}
		});

		scrollToTopBtn?.addEventListener('click', () => {
			window.scrollTo({
				top: 0,
				behavior: 'smooth'
			});
		});
	</script>
</Layout>

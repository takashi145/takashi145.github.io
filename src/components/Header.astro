---
import ThemeToggle from "./ThemeToggle.astro";

interface Props {
  currentPath?: string;
}

const navItems = [
  { name: "Home", href: "#home" },
  { name: "Skills", href: "#skills" },
  // { name: 'Experience', href: '#experience' },
  // { name: "Certifications", href: "#certifications" },
  { name: "Works", href: "#works" },
];
---

<header
  class="fixed top-0 left-0 right-0 z-50 bg-white/80 dark:bg-gray-900/80 backdrop-blur-sm border-b border-gray-200 dark:border-gray-800"
>
  <nav
    class="container mx-auto px-4 sm:px-6 lg:px-8 py-4 flex items-center justify-between max-w-7xl"
  >
    <a
      href="/"
      class="text-xl font-bold text-gray-900 dark:text-white hover:text-purple-500 dark:hover:text-purple-400 transition-colors"
    >
      takashi145
    </a>

    <div class="flex items-center gap-4 sm:gap-8">
      <ul class="flex gap-4 sm:gap-6">
        {
          navItems.map((item) => (
            <li>
              <a
                href={item.href}
                class="nav-link text-sm font-medium transition-colors text-gray-700 dark:text-gray-300 hover:text-purple-500 dark:hover:text-purple-400"
                data-section={item.href.slice(1)}
              >
                {item.name}
              </a>
            </li>
          ))
        }
      </ul>

      <ThemeToggle />
    </div>
  </nav>
</header>

<div class="h-16"></div>

<script>
  // アンカーリンクのスクロール
  const anchors = document.querySelectorAll('a[href^="#"]');
  anchors.forEach((a) => {
    a.addEventListener("click", (e) => {
      e.preventDefault();

      const id = a.getAttribute("href");
      if (!id || id === "#") return; // 無効なリンクは無視

      // 移動先の要素を取得
      const el = document.querySelector(id);
      if (!el) return;

      // 固定ヘッダー分のずれを考慮
      const offset = 80;
      const top = el.getBoundingClientRect().top + window.pageYOffset - offset;

      // スムーズスクロール
      window.scrollTo({
        top: top,
        behavior: "smooth",
      });

      // urlに反映
      history.replaceState(null, "", id);
    });
  });

  // 現在位置に応じてナビの表示切り替え
  const sections = document.querySelectorAll("section[id]");
  const navLinks = document.querySelectorAll(".nav-link");

  function updateNav() {
    let active = "";

    // 一番近いセクションを特定
    sections.forEach((sec) => {
      if (window.pageYOffset >= sec.offsetTop - 100) {
        active = sec.id;
      }
    });

    // ナビゲーションのアクティブ表示を更新
    navLinks.forEach((link) => {
      const target = link.getAttribute("data-section");

      link.classList.remove("text-purple-500", "dark:text-purple-400");
      link.classList.add("text-gray-700", "dark:text-gray-300");

      if (target === active) {
        link.classList.remove("text-gray-700", "dark:text-gray-300");
        link.classList.add("text-purple-500", "dark:text-purple-400");
      }
    });
  }

  window.addEventListener("scroll", updateNav);
  updateNav();
</script>
